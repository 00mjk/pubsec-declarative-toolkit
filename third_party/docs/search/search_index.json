{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"GCP Canadian PubSec Sandbox What is this Sandbox? The GCP Canadian PubSec Sandbox is an opionated way for Canadian Public Sector customers to standup a compliant Google Cloud environment that meets the 30 day Canadian Cloud Guardrails https://github.com/canada-ca/cloud-guardrails-gcp in order to experiment with Google Cloud Platform solutions. What problem does the Sandbox solve? It's difficult to know all products and solutions built on / in Google Cloud Platform. The Sandbox allows you to deploy a pre-built solution in a contained way to learn, investigate and experiment with different aspects of Google Cloud. You don't need to be an expert on GCP or Infrastructure as Code to deploy a solution, Sandbox makes solution deployment easy.","title":"Home"},{"location":"#gcp-canadian-pubsec-sandbox","text":"","title":"GCP Canadian PubSec Sandbox"},{"location":"#what-is-this-sandbox","text":"The GCP Canadian PubSec Sandbox is an opionated way for Canadian Public Sector customers to standup a compliant Google Cloud environment that meets the 30 day Canadian Cloud Guardrails https://github.com/canada-ca/cloud-guardrails-gcp in order to experiment with Google Cloud Platform solutions.","title":"What is this Sandbox?"},{"location":"#what-problem-does-the-sandbox-solve","text":"It's difficult to know all products and solutions built on / in Google Cloud Platform. The Sandbox allows you to deploy a pre-built solution in a contained way to learn, investigate and experiment with different aspects of Google Cloud. You don't need to be an expert on GCP or Infrastructure as Code to deploy a solution, Sandbox makes solution deployment easy.","title":"What problem does the Sandbox solve?"},{"location":"config-connector/","text":"Getting Started - Config Connector Running the quickstart will provision the necessary resources required to provision the sandbox environment. Enables the following services krmapihosting.googleapis.com (if using Config Controller) compute.googleapis.com container.googleapis.com cloudresourcemanager.googleapis.com A Private GKE Cluster with Workloadidentity and Config Connector enabled A Service Account to be used by Config Connector with the following roles roles/billing.user roles/compute.networkAdmin roles/compute.xpnAdmin roles/iam.organizationRoleAdmin roles/orgpolicy.policyAdmin roles/resourcemanager.folderAdmin roles/resourcemanager.organizationAdmin roles/resourcemanager.projectCreator roles/resourcemanager.projectDeleter roles/resourcemanager.projectIamAdmin roles/resourcemanager.projectMover roles/logging.configWriter roles/resourcemanager.projectIamAdmin roles/serviceusage.serviceUsageAdmin roles/bigquery.dataEditor storage.admin","title":"Config Connector"},{"location":"config-connector/#getting-started-config-connector","text":"Running the quickstart will provision the necessary resources required to provision the sandbox environment. Enables the following services krmapihosting.googleapis.com (if using Config Controller) compute.googleapis.com container.googleapis.com cloudresourcemanager.googleapis.com A Private GKE Cluster with Workloadidentity and Config Connector enabled A Service Account to be used by Config Connector with the following roles roles/billing.user roles/compute.networkAdmin roles/compute.xpnAdmin roles/iam.organizationRoleAdmin roles/orgpolicy.policyAdmin roles/resourcemanager.folderAdmin roles/resourcemanager.organizationAdmin roles/resourcemanager.projectCreator roles/resourcemanager.projectDeleter roles/resourcemanager.projectIamAdmin roles/resourcemanager.projectMover roles/logging.configWriter roles/resourcemanager.projectIamAdmin roles/serviceusage.serviceUsageAdmin roles/bigquery.dataEditor storage.admin","title":"Getting Started - Config Connector"},{"location":"getting-started/","text":"Getting Started There are some prerequisites in order to deploy the sandbox. Prerequisites GCP Organization GCP Account Cloud Shell kpt git Cloud Shell comes pre-installed with git and kpt. Sandbox comes with a bootstrap shell script that will create a project with a private GKE cluster that is pre-configured with Config Connector https://cloud.google.com/config-connector/docs/overview . The user that executes the bootstrap process must have certain required permissions in order to setup the configuration project. You can either grant the following roles or create a customer role with the required permissions. Predefined Roles Role Description Command Folder Creator Used to create Folder for Configuratio Project gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/resourcemanager.folderCreator' Project Creator Required to create project for hosting GKE Cluster gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/resourcemanager.projectCreator' Billing Account User Required to attach a billing account to the host project gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/billing.user' EITHER Organization Policy Administrator Required to adjust Organizational Policies on the configuration project folder gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/orgpolicy.policyAdmin' Security Administrator Required to apply IAM Policies to a Service Account at the Org level gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/iam.securityAdmin' OR JUST Organization Administrator Required to apply IAM Policies to a Service Account at the Org Level and adjust org policies gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/resourcemanager.organizationAdmin' Custom Role - Required Permissions If you wish to create a custom role for the bootstrap process then the following permissions need to be added to the role. NOTE : The user will also need to assigned the Organization Policy Administrator Role as these permission can not be assigned to a custom role. Quickstart Alternatives In CloudShell you can run: teachme docs/cloudshell-tutorial.md You can download the bootstrap script and following the steps in the following Docs . To get download bootstrap.sh download it from the releases page or use the following command: release=v0.0.1 wget https://github.com/GoogleCloudPlatform/gcp-pbmm-sandbox/releases/download/${release}/bootstrap.sh","title":"Prerequisites"},{"location":"getting-started/#getting-started","text":"There are some prerequisites in order to deploy the sandbox.","title":"Getting Started"},{"location":"getting-started/#prerequisites","text":"GCP Organization GCP Account Cloud Shell kpt git Cloud Shell comes pre-installed with git and kpt. Sandbox comes with a bootstrap shell script that will create a project with a private GKE cluster that is pre-configured with Config Connector https://cloud.google.com/config-connector/docs/overview . The user that executes the bootstrap process must have certain required permissions in order to setup the configuration project. You can either grant the following roles or create a customer role with the required permissions.","title":"Prerequisites"},{"location":"getting-started/#predefined-roles","text":"Role Description Command Folder Creator Used to create Folder for Configuratio Project gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/resourcemanager.folderCreator' Project Creator Required to create project for hosting GKE Cluster gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/resourcemanager.projectCreator' Billing Account User Required to attach a billing account to the host project gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/billing.user' EITHER Organization Policy Administrator Required to adjust Organizational Policies on the configuration project folder gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/orgpolicy.policyAdmin' Security Administrator Required to apply IAM Policies to a Service Account at the Org level gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/iam.securityAdmin' OR JUST Organization Administrator Required to apply IAM Policies to a Service Account at the Org Level and adjust org policies gcloud organizations add-iam-policy-binding $ORG_ID --member=\"user:${USER_EMAIL}\" --role='roles/resourcemanager.organizationAdmin'","title":"Predefined Roles"},{"location":"getting-started/#custom-role-required-permissions","text":"If you wish to create a custom role for the bootstrap process then the following permissions need to be added to the role. NOTE : The user will also need to assigned the Organization Policy Administrator Role as these permission can not be assigned to a custom role.","title":"Custom Role - Required Permissions"},{"location":"getting-started/#quickstart","text":"","title":"Quickstart"},{"location":"getting-started/#alternatives","text":"In CloudShell you can run: teachme docs/cloudshell-tutorial.md You can download the bootstrap script and following the steps in the following Docs . To get download bootstrap.sh download it from the releases page or use the following command: release=v0.0.1 wget https://github.com/GoogleCloudPlatform/gcp-pbmm-sandbox/releases/download/${release}/bootstrap.sh","title":"Alternatives"},{"location":"governance/","text":"Organizational Policies Sandbox will adhear the following organizational policies. These policies are in-line with the 30 Day Guardrails Org Policy Usage Guardrail Enforced Restrict VM External Access This list constraint defines the set of Compute Engine VM instances that are allowed to use external IP addresses. The allowed/denied list of VM instances must be identified by the VM instance name, in the form: projects/PROJECT_ID/zones/ZONE/instances/INSTANCE 06 - Network Security Services Require Trusted Images This list constraint defines the set of projects that can be used for image storage and disk instantiation for Compute Engine. https://cloud.google.com/compute/docs/images/restricting-image-access Restrict VPC Peering This list constraint defines the set of VPC networks that are allowed to be peered with the VPC networks belonging to this project, folder, or organization. The allowed/denied list of networks must be identified in the form: organizations/ORGANIZATION_ID, folders/FOLDER_ID, projects/PROJECT_ID, or projects/PROJECT_ID/global/networks/NETWORK_NAME. 06 - Network Security Services Require Shielded VMs This boolean constraint, when set to True, requires that all new Compute Engine VM instances use Shielded disk images with Secure Boot, vTPM, and Integrity Monitoring options enabled. Secure Boot can be disabled after creation, if desired. Existing running instances will continue to work as usual. Resource Locations This list constraint defines the set of locations where location-based GCP resources can be created. 05 - Data Location Disable VPC External IPV6 This boolean constraint, when set to True, disables the creation of or update to subnetworks with a stack_type of IPV4_IPV6 and ipv6_access_type of EXTERNAL. 06 - Network Security Services Disable Service Account Key Creation This boolean constraint disables the creation of service account external keys where this constraint is set to True . 02 - Management of Administrative Privileges Enforce Uniform bucket-level IAM Access and management This boolean constraint requires buckets to use uniform bucket-level access where this constraint is set to True. Any new bucket in the Organization resource must have uniform bucket-level access enabled, and no existing buckets in the organization resource can disable uniform bucket-level access. 02 - Management of Administrative Privileges Requires OS login for any SSH/RDP needs This boolean constraint, when set to true, enables OS Login on all newly created Projects. All VM instances created in new projects will have OS Login enabled. On new and existing projects, this constraint prevents metadata updates that disable OS Login at the project or instance level. 06 - Network Security Services Restrict Load Balancer Creation Based on Load Balancer Types This list constraint defines the set of load balancer types which can be created for an organization, folder, or project. Every load balancer type to be allowed or denied must be listed explicitly.Options: INTERNAL, EXTERNAL, INTERNAL_TCP_UDP, INTERNAL_HTTP_HTTPS, EXTERNAL_NETWORK_TCP_UDP EXTERNAL_TCP_PROXY, EXTERNAL_SSL_PROXY, EXTERNAL_HTTP_HTTPS, EXTERNAL_MANAGED_HTTP_HTTPS 06 - Network Security Services Domain restricted sharing This list constraint defines one or more Cloud Identity or Google Workspace customer IDs whose principals can be added to IAM policies. To get instructions workspace ID make sure you are logged in as the admin user for admin.google.com In your Google Admin console (at admin.google.com)... Go to Account settings > Profile. Next to Customer ID, find your organization's unique ID. 02 - Management of Administrative Privileges Disable Serial Port Access This boolean constraint disables serial port access to Compute Engine VMs belonging to the organization, project, or folder where this constraint is set to True. 02 - Management of Administrative Privileges VM Can IP Forward This list constraint defines the set of VM instances that can enable IP forwarding. By default, any VM can enable IP forwarding in any virtual network. VM instances must be specified in the form: organizations/ORGANIZATION_ID, folders/FOLDER_ID, projects/PROJECT_ID, or projects/PROJECT_ID/zones/ZONE/instances/INSTANCE-NAME. 06 - Network Security Services Disable VM nested virtualization This boolean constraint disables hardware-accelerated nested virtualization for all Compute Engine VMs belonging to the organization, project, or folder where this constraint is set to True. Restrict shared VPC project lien removal This boolean constraint restricts the set of users that can remove a Shared VPC project lien without organization-level permission where this constraint is set to True. 06 - Network Security Services Restrict Public IP access on Cloud SQL instances This boolean constraint restricts configuring Public IP on Cloud SQL instances where this constraint is set to True. This constraint is not retroactive, Cloud SQL instances with existing Public IP access will still work even after this constraint is enforced. 06 - Network Security Services Enforce Public Access Prevention (Preview) Secure your Cloud Storage data from public exposure by enforcing public access prevention. This governance policy prevents existing and future resources from being accessed via the public internet by disabling and blocking ACLs and IAM permissions that grant access to allUsers and allAuthenticatedUsers 06 - Network Security Services Folder Structure A basic folder structure to deploy the included resources Guardrails Configuration to comply with the GC 30 Day Guardrails IAM Roles Log Sinks Source Control Cloud Build Trigger and Scheduler for BreakGlass alerting.","title":"Governance"},{"location":"governance/#organizational-policies","text":"Sandbox will adhear the following organizational policies. These policies are in-line with the 30 Day Guardrails Org Policy Usage Guardrail Enforced Restrict VM External Access This list constraint defines the set of Compute Engine VM instances that are allowed to use external IP addresses. The allowed/denied list of VM instances must be identified by the VM instance name, in the form: projects/PROJECT_ID/zones/ZONE/instances/INSTANCE 06 - Network Security Services Require Trusted Images This list constraint defines the set of projects that can be used for image storage and disk instantiation for Compute Engine. https://cloud.google.com/compute/docs/images/restricting-image-access Restrict VPC Peering This list constraint defines the set of VPC networks that are allowed to be peered with the VPC networks belonging to this project, folder, or organization. The allowed/denied list of networks must be identified in the form: organizations/ORGANIZATION_ID, folders/FOLDER_ID, projects/PROJECT_ID, or projects/PROJECT_ID/global/networks/NETWORK_NAME. 06 - Network Security Services Require Shielded VMs This boolean constraint, when set to True, requires that all new Compute Engine VM instances use Shielded disk images with Secure Boot, vTPM, and Integrity Monitoring options enabled. Secure Boot can be disabled after creation, if desired. Existing running instances will continue to work as usual. Resource Locations This list constraint defines the set of locations where location-based GCP resources can be created. 05 - Data Location Disable VPC External IPV6 This boolean constraint, when set to True, disables the creation of or update to subnetworks with a stack_type of IPV4_IPV6 and ipv6_access_type of EXTERNAL. 06 - Network Security Services Disable Service Account Key Creation This boolean constraint disables the creation of service account external keys where this constraint is set to True . 02 - Management of Administrative Privileges Enforce Uniform bucket-level IAM Access and management This boolean constraint requires buckets to use uniform bucket-level access where this constraint is set to True. Any new bucket in the Organization resource must have uniform bucket-level access enabled, and no existing buckets in the organization resource can disable uniform bucket-level access. 02 - Management of Administrative Privileges Requires OS login for any SSH/RDP needs This boolean constraint, when set to true, enables OS Login on all newly created Projects. All VM instances created in new projects will have OS Login enabled. On new and existing projects, this constraint prevents metadata updates that disable OS Login at the project or instance level. 06 - Network Security Services Restrict Load Balancer Creation Based on Load Balancer Types This list constraint defines the set of load balancer types which can be created for an organization, folder, or project. Every load balancer type to be allowed or denied must be listed explicitly.Options: INTERNAL, EXTERNAL, INTERNAL_TCP_UDP, INTERNAL_HTTP_HTTPS, EXTERNAL_NETWORK_TCP_UDP EXTERNAL_TCP_PROXY, EXTERNAL_SSL_PROXY, EXTERNAL_HTTP_HTTPS, EXTERNAL_MANAGED_HTTP_HTTPS 06 - Network Security Services Domain restricted sharing This list constraint defines one or more Cloud Identity or Google Workspace customer IDs whose principals can be added to IAM policies. To get instructions workspace ID make sure you are logged in as the admin user for admin.google.com In your Google Admin console (at admin.google.com)... Go to Account settings > Profile. Next to Customer ID, find your organization's unique ID. 02 - Management of Administrative Privileges Disable Serial Port Access This boolean constraint disables serial port access to Compute Engine VMs belonging to the organization, project, or folder where this constraint is set to True. 02 - Management of Administrative Privileges VM Can IP Forward This list constraint defines the set of VM instances that can enable IP forwarding. By default, any VM can enable IP forwarding in any virtual network. VM instances must be specified in the form: organizations/ORGANIZATION_ID, folders/FOLDER_ID, projects/PROJECT_ID, or projects/PROJECT_ID/zones/ZONE/instances/INSTANCE-NAME. 06 - Network Security Services Disable VM nested virtualization This boolean constraint disables hardware-accelerated nested virtualization for all Compute Engine VMs belonging to the organization, project, or folder where this constraint is set to True. Restrict shared VPC project lien removal This boolean constraint restricts the set of users that can remove a Shared VPC project lien without organization-level permission where this constraint is set to True. 06 - Network Security Services Restrict Public IP access on Cloud SQL instances This boolean constraint restricts configuring Public IP on Cloud SQL instances where this constraint is set to True. This constraint is not retroactive, Cloud SQL instances with existing Public IP access will still work even after this constraint is enforced. 06 - Network Security Services Enforce Public Access Prevention (Preview) Secure your Cloud Storage data from public exposure by enforcing public access prevention. This governance policy prevents existing and future resources from being accessed via the public internet by disabling and blocking ACLs and IAM permissions that grant access to allUsers and allAuthenticatedUsers 06 - Network Security Services","title":"Organizational Policies"},{"location":"governance/#folder-structure","text":"A basic folder structure to deploy the included resources Guardrails Configuration to comply with the GC 30 Day Guardrails IAM Roles Log Sinks Source Control Cloud Build Trigger and Scheduler for BreakGlass alerting.","title":"Folder Structure"},{"location":"issues/","text":"Known Issues Kubectl Timeouts out If your Kubectl timesout if you are making changes to your config controller GKE cluster then this is most likely because your IP address of your host / Cloud Shell environment hasn't been added to Authorized Master Networks. You can run dig +short myip.opendns.com @resolver1.opendns.com to get your IP address. Then run gcloud container clusters update CLUSTER_NAME --master-authorized-networks=CIDR, CIDR to update the cluster.","title":"Known Issues"},{"location":"issues/#known-issues","text":"Kubectl Timeouts out If your Kubectl timesout if you are making changes to your config controller GKE cluster then this is most likely because your IP address of your host / Cloud Shell environment hasn't been added to Authorized Master Networks. You can run dig +short myip.opendns.com @resolver1.opendns.com to get your IP address. Then run gcloud container clusters update CLUSTER_NAME --master-authorized-networks=CIDR, CIDR to update the cluster.","title":"Known Issues"},{"location":"solutions/","text":"Solutions What is a Solution Sandbox This repostory contains a series of KRM (Kubernetes Resource Model) kpt packages needed to deploy Sandbox Environments in Google Cloud. kpt is a Git-native, schema-aware, extensible client-side tool for packaging, customizing, validating, and applying Kubernetes resources. Each kpt package contains configuration files to be used with a Config Connector enabled Kubernetes Cluster or using the Config Controller service. These packages will container a package for Guardrails and a package for the associated Servce(s). For example the sandbox-gke bundles the guardrails and private-gke bundles to create its sandbox environment. Available Sandbox Solutions Sandbox Command Private GKE Cluster kpt pkg get git@github.com:GoogleCloudPlatform/gcp-pbmm-sandbox.git/solutions/sandbox-gke GKE Sandbox The following services will be deployed into a GKE-Sandbox folder for learning and development. - Private GKE Instance - Artifact Registry - Secret Manager - BinaryAuthorization - Anthos","title":"Solutions"},{"location":"solutions/#solutions","text":"","title":"Solutions"},{"location":"solutions/#what-is-a-solution-sandbox","text":"This repostory contains a series of KRM (Kubernetes Resource Model) kpt packages needed to deploy Sandbox Environments in Google Cloud. kpt is a Git-native, schema-aware, extensible client-side tool for packaging, customizing, validating, and applying Kubernetes resources. Each kpt package contains configuration files to be used with a Config Connector enabled Kubernetes Cluster or using the Config Controller service. These packages will container a package for Guardrails and a package for the associated Servce(s). For example the sandbox-gke bundles the guardrails and private-gke bundles to create its sandbox environment.","title":"What is a Solution Sandbox"},{"location":"solutions/#available-sandbox-solutions","text":"Sandbox Command Private GKE Cluster kpt pkg get git@github.com:GoogleCloudPlatform/gcp-pbmm-sandbox.git/solutions/sandbox-gke","title":"Available Sandbox Solutions"},{"location":"solutions/#gke-sandbox","text":"The following services will be deployed into a GKE-Sandbox folder for learning and development. - Private GKE Instance - Artifact Registry - Secret Manager - BinaryAuthorization - Anthos","title":"GKE Sandbox"}]}